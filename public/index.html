<!DOCTYPE html>
<html>
<head>
  <title>Team Game</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 40px; }
    .section { margin-bottom: 30px; padding: 20px; border: 1px solid #ddd; border-radius: 5px; }
    input, button { margin: 5px; padding: 8px; }
    button { background-color: #007bff; color: white; border: none; border-radius: 3px; cursor: pointer; }
    button:hover { background-color: #0056b3; }
    .result { margin-top: 10px; padding: 10px; background-color: #f8f9fa; border-radius: 3px; }
    .game-id { font-size: 18px; font-weight: bold; color: #007bff; margin: 10px 0; }
    .game-info { background-color: #e7f3ff; border: 1px solid #007bff; border-radius: 5px; padding: 15px; margin: 10px 0; }
    .nav-links {
      margin-bottom: 20px;
      padding: 15px;
      background: #e9ecef;
      border-radius: 5px;
      border: 1px solid #dee2e6;
    }
    .nav-links a {
      color: #007bff;
      text-decoration: none;
      margin-right: 20px;
      font-weight: bold;
    }
    .nav-links a:hover {
      text-decoration: underline;
    }
    .nav-links .admin-link {
      background: #28a745;
      color: white;
      padding: 8px 15px;
      border-radius: 4px;
    }
    .nav-links .admin-link:hover {
      background: #218838;
      text-decoration: none;
    }
  </style>
</head>
<body>
  <h1>üéÆ Team Game</h1>
  
  <div class="nav-links">
    <a href="admin.html" class="admin-link">‚öôÔ∏è Admin Panel</a>
    <a href="join.html" style="background: #17a2b8; color: white; padding: 8px 15px; border-radius: 4px;">üéÆ Join Game</a>
    <span style="color: #6c757d;">|</span>
    <span style="color: #6c757d;">Main Interface - For testing individual API endpoints</span>
  </div>

  <div class="section">
    <h2>Create Game</h2>
    <input id="adminName" placeholder="Enter admin name" />
    <input id="numTeams" type="number" min="2" max="10" value="2" placeholder="Number of teams (2-10)" />
    <button onclick="createGame()">Create Game</button>
    <div id="createResult" class="result"></div>
  </div>

  <div class="section">
    <h2>Game Information</h2>
    <input id="lookupGameCode" placeholder="Enter game code to lookup" />
    <button onclick="getGameInfo()">Get Game Info</button>
    <div id="gameInfoResult" class="result"></div>
  </div>

  <div class="section">
    <h2>Join Game</h2>
    <input id="gameCode" placeholder="Enter game code" />
    <input id="playerName" placeholder="Enter your name" />
    <button onclick="addPlayer()">Join Game</button>
    <div id="joinResult" class="result"></div>
  </div>

  <div class="section">
    <h2>Start Game</h2>
    <input id="startGameId" placeholder="Enter gameId" />
    <button onclick="startGame()">Start Game</button>
    <div id="startResult" class="result"></div>
  </div>

  <div class="section">
    <h2>Select Origin Team</h2>
    <input id="originGameId" placeholder="Enter gameId" />
            <input id="originTeamId" placeholder="Enter teamId (e.g., team_1)" />
    <button onclick="selectOriginTeam()">Select Origin Team</button>
    <div id="originResult" class="result"></div>
  </div>

  <div class="section">
    <h2>Current Round Info</h2>
    <input id="roundGameId" placeholder="Enter gameId" />
    <button onclick="getCurrentRound()">Get Current Round</button>
    <div id="roundResult" class="result"></div>
  </div>

  <div class="section">
    <h2>Team Information</h2>
    <input id="teamInfoGameId" placeholder="Enter gameId" />
    <input id="teamInfoTeamId" placeholder="Enter teamId" />
    <button onclick="getTeamInfo()">Get Team Info</button>
    <div id="teamInfoResult" class="result"></div>
  </div>

  <div class="section">
    <h2>Team Details (with Team Lead)</h2>
    <input id="teamDetailsGameId" placeholder="Enter gameId" />
    <input id="teamDetailsTeamId" placeholder="Enter teamId" />
    <button onclick="getTeamDetails()">Get Team Details</button>
    <div id="teamDetailsResult" class="result"></div>
  </div>

  <div class="section">
    <h2>Origin Team Information</h2>
    <p><strong>Instructions:</strong></p>
    <ol>
      <li>Enter the <strong>Round ID</strong> to see who the origin team is</li>
      <li>This shows the team and players that other teams are guessing for</li>
    </ol>
    <input id="originTeamRoundId" placeholder="Enter roundId" />
    <button onclick="getOriginTeamInfo()">Get Origin Team Info</button>
    <div id="originTeamResult" class="result"></div>
  </div>

  <div class="section">
    <h2>Set Round Preferences</h2>
    <p><strong>Instructions:</strong></p>
    <ol>
      <li>Get the Round ID from "Current Round Info" section above</li>
      <li>Enter a category (e.g., Movies, Food, Books, Travel Destinations)</li>
      <li>Enter 5-10 items for that category (separated by commas or new lines)</li>
    </ol>
    <p><strong>Example Categories & Items:</strong></p>
    <ul>
      <li><strong>Movies:</strong> The Matrix, Inception, Interstellar, The Dark Knight, Pulp Fiction</li>
      <li><strong>Food:</strong> Pizza, Sushi, Tacos, Burgers, Ice Cream</li>
      <li><strong>Books:</strong> Harry Potter, Lord of the Rings, 1984, The Hobbit, Pride and Prejudice</li>
    </ul>
    <input id="prefRoundId" placeholder="Enter roundId (copy from Current Round Info)" />
    <input id="prefCategory" placeholder="Enter category (e.g., Movies, Food)" />
    <textarea id="prefItems" placeholder="Enter items (one per line or comma-separated)&#10;Example: The Matrix, Inception, Interstellar, The Dark Knight, Pulp Fiction" rows="4"></textarea>
    <button onclick="setRoundPreferences()">Set Preferences</button>
    <div id="prefResult" class="result"></div>
  </div>

  <div class="section">
    <h2>Submit Origin Team Ranking</h2>
    <p><strong>Instructions:</strong></p>
    <ol>
      <li>Get the <strong>Round ID</strong> from "Current Round Info"</li>
              <li>Get the <strong>Team ID</strong> (e.g., team_1) from the team assignment or round info</li>
      <li>Enter the ordered list of items (comma or newline separated, in the team's preferred order)</li>
    </ol>
    <input id="originRankRoundId" placeholder="Enter roundId (copy from Current Round Info)" />
            <input id="originRankTeamId" placeholder="Enter teamId (e.g., team_1)" />
    <textarea id="originRankItems" placeholder="Enter ordered items (comma or newline separated)" rows="3"></textarea>
    <button onclick="submitOriginRanking()">Submit Origin Ranking</button>
    <div id="originRankResult" class="result"></div>
  </div>

  <div class="section">
    <h2>Submit Guess</h2>
    <p><strong>Instructions:</strong></p>
    <ol>
      <li>Get the <strong>Round ID</strong> from "Current Round Info"</li>
      <li>Enter the <strong>Team ID</strong> (must be different from origin team)</li>
      <li>Enter the guessed order of items (comma or newline separated)</li>
    </ol>
    <input id="guessRoundId" placeholder="Enter roundId" />
            <input id="guessTeamId" placeholder="Enter teamId (e.g., team_2)" />
    <textarea id="guessItems" placeholder="Enter guessed order of items (comma or newline separated)" rows="3"></textarea>
    <button onclick="submitGuess()">Submit Guess</button>
    <div id="guessResult" class="result"></div>
  </div>

  <div class="section">
    <h2>Score Guesses</h2>
    <p><strong>Instructions:</strong></p>
    <ol>
      <li>Enter the <strong>Round ID</strong> to see scores for all guesses</li>
      <li>This will show how many items each team got correct in order</li>
    </ol>
    <input id="scoreRoundId" placeholder="Enter roundId" />
    <button onclick="scoreGuesses()">Score Guesses</button>
    <div id="scoreResult" class="result"></div>
  </div>

  <div class="section">
    <h2>Game Scoreboard</h2>
    <p><strong>Instructions:</strong></p>
    <ol>
      <li>Enter the <strong>Game ID</strong> to see overall scores for all teams</li>
      <li>This shows cumulative scores across all rounds</li>
    </ol>
    <input id="scoreboardGameId" placeholder="Enter gameId" />
    <button onclick="getScoreboard()">Get Scoreboard</button>
    <div id="scoreboardResult" class="result"></div>
  </div>

  <div class="section">
    <h2>Declare Winner</h2>
    <p><strong>Instructions:</strong></p>
    <ol>
      <li>Enter the <strong>Game ID</strong> to determine the winner(s)</li>
      <li>This will show which team(s) have the highest score</li>
      <li>In case of a tie, all tied teams will be shown as winners</li>
    </ol>
    <input id="winnerGameId" placeholder="Enter gameId" />
    <button onclick="declareWinner()">Declare Winner</button>
    <div id="winnerResult" class="result"></div>
  </div>

  <script>
    async function createGame() {
      const adminName = document.getElementById('adminName').value;
      const numTeams = parseInt(document.getElementById('numTeams').value);
      
      if (!adminName) {
        document.getElementById('createResult').innerText = 'Please enter an admin name';
        return;
      }
      
      if (!numTeams || numTeams < 2 || numTeams > 10) {
        document.getElementById('createResult').innerText = 'Please enter a valid number of teams (2-10)';
        return;
      }
      
      try {
        const res = await fetch('http://localhost:4000/api/create-game', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ adminName, numTeams })
        });
        const data = await res.json();
        document.getElementById('createResult').innerHTML = `
          <div class="game-info">
            <div class="game-id">Game Created Successfully!</div>
            <div><strong>Game ID:</strong> ${data.gameId}</div>
            <div><strong>Game Code:</strong> ${data.gameCode}</div>
            <div><strong>Admin:</strong> ${data.adminName}</div>
            <div><strong>Number of Teams:</strong> ${data.numTeams}</div>
            <div><strong>Status:</strong> ${data.status}</div>
          </div>
        `;
      } catch (error) {
        document.getElementById('createResult').innerText = `Error: ${error.message}`;
      }
    }

    async function getGameInfo() {
      const gameCode = document.getElementById('lookupGameCode').value;
      if (!gameCode) {
        document.getElementById('gameInfoResult').innerText = 'Please enter a game code';
        return;
      }
      
      try {
        const res = await fetch(`http://localhost:4000/api/game-info/${gameCode}`);
        const data = await res.json();
        
        if (res.ok) {
          document.getElementById('gameInfoResult').innerHTML = `
            <div class="game-info">
              <div class="game-id">Game Information</div>
              <div><strong>Game ID:</strong> ${data.gameId}</div>
              <div><strong>Game Code:</strong> ${data.gameCode}</div>
              <div><strong>Admin:</strong> ${data.adminName}</div>
              <div><strong>Players:</strong> ${data.playerCount}</div>
              <div><strong>Number of Teams:</strong> ${data.numTeams || 'Not set'}</div>
              <div><strong>Status:</strong> ${data.status}</div>
            </div>
          `;
        } else {
          document.getElementById('gameInfoResult').innerText = `Error: ${data.error}`;
        }
      } catch (error) {
        document.getElementById('gameInfoResult').innerText = `Error: ${error.message}`;
      }
    }

    async function addPlayer() {
      const gameCode = document.getElementById('gameCode').value;
      const playerName = document.getElementById('playerName').value;
      
      if (!gameCode || !playerName) {
        document.getElementById('joinResult').innerText = 'Please enter both game code and player name';
        return;
      }
      
      try {
        const res = await fetch('http://localhost:4000/api/add-player', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ gameCode, playerName })
        });
        const data = await res.json();
        
        if (res.ok) {
          document.getElementById('joinResult').innerText = `Successfully joined! Player ID: ${data.playerId}`;
        } else {
          document.getElementById('joinResult').innerText = `Error: ${data.error}`;
        }
      } catch (error) {
        document.getElementById('joinResult').innerText = `Error: ${error.message}`;
      }
    }

    async function startGame() {
      const gameId = document.getElementById('startGameId').value;
      if (!gameId) {
        document.getElementById('startResult').innerText = 'Please enter a gameId';
        return;
      }
      
      try {
        const res = await fetch('http://localhost:4000/api/start-game', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ gameId })
        });
        const data = await res.json();
        
        if (res.ok) {
          let teamsHtml = '';
          if (data.teams && data.teams.length > 0) {
            teamsHtml = data.teams.map(team => 
              `<div><strong>${team.name}:</strong> ${team.playerIds.length} players (Lead ID: ${team.leadId})</div>`
            ).join('');
          }
          
          document.getElementById('startResult').innerHTML = `
            <div class="game-info">
              <div class="game-id">Game Started Successfully!</div>
              <div><strong>Game ID:</strong> ${gameId}</div>
              <div><strong>Message:</strong> ${data.message}</div>
              <div><strong>Distribution:</strong></div>
              <div>- Total Players: ${data.distribution.totalPlayers}</div>
              <div>- Number of Teams: ${data.distribution.numTeams}</div>
              <div>- Base Team Size: ${data.distribution.baseTeamSize}</div>
              <div>- Extra Players: ${data.distribution.remainder}</div>
              <div><strong>Teams:</strong></div>
              ${teamsHtml}
            </div>
          `;
        } else {
          document.getElementById('startResult').innerText = `Error: ${data.error}`;
        }
      } catch (error) {
        document.getElementById('startResult').innerText = `Error: ${error.message}`;
      }
    }

    async function selectOriginTeam() {
      const gameId = document.getElementById('originGameId').value;
      const teamId = document.getElementById('originTeamId').value;
      
      if (!gameId || !teamId) {
        document.getElementById('originResult').innerText = 'Please enter both gameId and teamId';
        return;
      }
      
      try {
        const res = await fetch('http://localhost:4000/api/select-origin-team', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ gameId, teamId })
        });
        const data = await res.json();
        
        if (res.ok) {
          document.getElementById('originResult').innerHTML = `
            <div class="game-info">
              <div class="game-id">Origin Team Selected!</div>
              <div><strong>Round ID:</strong> ${data.round.roundId}</div>
              <div><strong>Origin Team:</strong> ${data.round.originTeamId}</div>
              <div><strong>Status:</strong> ${data.round.status}</div>
              <div><strong>Message:</strong> ${data.message}</div>
            </div>
          `;
        } else {
          document.getElementById('originResult').innerText = `Error: ${data.error}`;
        }
      } catch (error) {
        document.getElementById('originResult').innerText = `Error: ${error.message}`;
      }
    }

    async function getCurrentRound() {
      const gameId = document.getElementById('roundGameId').value;
      if (!gameId) {
        document.getElementById('roundResult').innerText = 'Please enter a gameId';
        return;
      }
      
      try {
        const res = await fetch(`http://localhost:4000/api/current-round/${gameId}`);
        const data = await res.json();
        
        if (res.ok && data.round) {
          let roundHtml = `
            <div class="game-info">
              <div class="game-id">Current Round Information</div>
              <div><strong>Round ID:</strong> ${data.round.roundId}</div>
              <div><strong>Origin Team ID:</strong> ${data.round.originTeamId}</div>
              <div><strong>Status:</strong> ${data.round.status}</div>
              <div><strong>Category:</strong> ${data.round.category || 'Not set'}</div>
              <div><strong>Items:</strong> ${data.round.items.length > 0 ? data.round.items.join(', ') : 'Not set'}</div>
              <div><strong>Origin Ranking:</strong> ${data.round.originRanking ? data.round.originRanking.join(', ') : 'Not submitted'}</div>
              <div><strong>Guesses:</strong> ${data.round.guesses.length}</div>
          `;
          
          // Try to get origin team info if we have a round
          try {
            const originRes = await fetch(`http://localhost:4000/api/origin-team-info/${data.round.roundId}`);
            const originData = await originRes.json();
            
            if (originRes.ok && originData.originTeam) {
              const originTeam = originData.originTeam;
              roundHtml += `
                <div style="margin-top: 15px; padding: 10px; background-color: #e7f3ff; border: 1px solid #007bff; border-radius: 4px;">
                  <div><strong>üéØ Origin Team:</strong> ${originTeam.teamName}</div>
                  <div><strong>Team Lead:</strong> ${originTeam.leadName}</div>
                  <div><strong>Members:</strong> ${originTeam.memberNames.join(', ')}</div>
                </div>
              `;
            }
          } catch (originError) {
            // If origin team info fails, just continue without it
            console.log('Could not fetch origin team info:', originError);
          }
          
          roundHtml += `</div>`;
          document.getElementById('roundResult').innerHTML = roundHtml;
        } else {
          document.getElementById('roundResult').innerText = 'No current round found for this game';
        }
      } catch (error) {
        document.getElementById('roundResult').innerText = `Error: ${error.message}`;
      }
    }

    async function getTeamInfo() {
      const gameId = document.getElementById('teamInfoGameId').value;
      const teamId = document.getElementById('teamInfoTeamId').value;
      
      if (!gameId || !teamId) {
        document.getElementById('teamInfoResult').innerText = 'Please enter both gameId and teamId';
        return;
      }
      
      try {
        const res = await fetch(`http://localhost:4000/api/team-info/${gameId}/${teamId}`);
        const data = await res.json();
        
        if (res.ok) {
          document.getElementById('teamInfoResult').innerHTML = `
            <div class="game-info">
              <div class="game-id">Team Information</div>
              <div><strong>Team ID:</strong> ${data.teamId}</div>
              <div><strong>Team Name:</strong> ${data.name}</div>
              <div><strong>Players:</strong> ${data.players.map(p => p.playerName).join(', ')}</div>
              <div><strong>Player Count:</strong> ${data.players.length}</div>
            </div>
          `;
        } else {
          document.getElementById('teamInfoResult').innerText = `Error: ${data.error}`;
        }
      } catch (error) {
        document.getElementById('teamInfoResult').innerText = `Error: ${error.message}`;
      }
    }

    async function getTeamDetails() {
      const gameId = document.getElementById('teamDetailsGameId').value;
      const teamId = document.getElementById('teamDetailsTeamId').value;
      
      if (!gameId || !teamId) {
        document.getElementById('teamDetailsResult').innerText = 'Please enter both gameId and teamId';
        return;
      }
      
      try {
        const res = await fetch(`http://localhost:4000/api/team-details/${gameId}/${teamId}`);
        const data = await res.json();
        
        if (res.ok) {
          document.getElementById('teamDetailsResult').innerHTML = `
            <div class="game-info">
              <div class="game-id">Team Details</div>
              <div><strong>Team ID:</strong> ${data.teamId}</div>
              <div><strong>Team Name:</strong> ${data.name}</div>
              <div><strong>Team Lead:</strong> ${data.leadName} (ID: ${data.leadId})</div>
              <div><strong>Players:</strong> ${data.players.map(p => p.playerName).join(', ')}</div>
              <div><strong>Player Count:</strong> ${data.players.length}</div>
            </div>
          `;
        } else {
          document.getElementById('teamDetailsResult').innerText = `Error: ${data.error}`;
        }
      } catch (error) {
        document.getElementById('teamDetailsResult').innerText = `Error: ${error.message}`;
      }
    }

    async function getOriginTeamInfo() {
      const roundId = document.getElementById('originTeamRoundId').value;
      
      if (!roundId) {
        document.getElementById('originTeamResult').innerText = 'Please enter a roundId';
        return;
      }
      
      try {
        const res = await fetch(`http://localhost:4000/api/origin-team-info/${roundId}`);
        const data = await res.json();
        
        if (res.ok) {
          const originTeam = data.originTeam;
          document.getElementById('originTeamResult').innerHTML = `
            <div class="game-info">
              <div class="game-id">üéØ Origin Team Information</div>
              <div><strong>Round ID:</strong> ${roundId}</div>
              <div><strong>Origin Team:</strong> ${originTeam.teamName}</div>
              <div><strong>Team Lead:</strong> ${originTeam.leadName}</div>
              <div><strong>Team Members:</strong> ${originTeam.memberNames.join(', ')}</div>
              <div><strong>Total Members:</strong> ${originTeam.memberNames.length}</div>
              <div style="margin-top: 10px; padding: 10px; background-color: #fff3cd; border: 1px solid #ffeaa7; border-radius: 4px;">
                <strong>üí° Game Context:</strong> Other teams are guessing how <strong>${originTeam.teamName}</strong> would rank the items in this round.
              </div>
            </div>
          `;
        } else {
          document.getElementById('originTeamResult').innerText = `Error: ${data.error}`;
        }
      } catch (error) {
        document.getElementById('originTeamResult').innerText = `Error: ${error.message}`;
      }
    }

    async function setRoundPreferences() {
      const roundId = document.getElementById('prefRoundId').value;
      const category = document.getElementById('prefCategory').value;
      const itemsText = document.getElementById('prefItems').value;
      
      if (!roundId || !category || !itemsText) {
        document.getElementById('prefResult').innerText = 'Please enter roundId, category, and items';
        return;
      }
      
      // Parse items - support both comma-separated and newline-separated
      const items = itemsText.split(/[,\n]/).map(item => item.trim()).filter(item => item.length > 0);
      
      if (items.length === 0) {
        document.getElementById('prefResult').innerText = 'Please enter at least one item';
        return;
      }
      
      try {
        const res = await fetch('http://localhost:4000/api/set-round-preferences', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ roundId, category, items })
        });
        const data = await res.json();
        
        if (res.ok) {
          document.getElementById('prefResult').innerHTML = `
            <div class="game-info">
              <div class="game-id">Round Preferences Set!</div>
              <div><strong>Round ID:</strong> ${data.round.roundId}</div>
              <div><strong>Category:</strong> ${data.round.category}</div>
              <div><strong>Items:</strong> ${data.round.items.join(', ')}</div>
              <div><strong>Status:</strong> ${data.round.status}</div>
              <div><strong>Message:</strong> ${data.message}</div>
            </div>
          `;
        } else {
          document.getElementById('prefResult').innerText = `Error: ${data.error}`;
        }
      } catch (error) {
        document.getElementById('prefResult').innerText = `Error: ${error.message}`;
      }
    }

    async function submitOriginRanking() {
      const roundId = document.getElementById('originRankRoundId').value;
      const teamId = document.getElementById('originRankTeamId').value;
      const itemsText = document.getElementById('originRankItems').value;
      if (!roundId || !teamId || !itemsText) {
        document.getElementById('originRankResult').innerText = 'Please enter roundId, teamId, and items';
        return;
      }
      const orderedItems = itemsText.split(/[\n,]/).map(item => item.trim()).filter(item => item.length > 0);
      if (orderedItems.length === 0) {
        document.getElementById('originRankResult').innerText = 'Please enter at least one item';
        return;
      }
      try {
        const res = await fetch('http://localhost:4000/api/submit-origin-ranking', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ roundId, teamId, orderedItems })
        });
        const data = await res.json();
        if (res.ok) {
          document.getElementById('originRankResult').innerHTML = `
            <div class="game-info">
              <div class="game-id">Origin Ranking Submitted!</div>
              <div><strong>Round ID:</strong> ${data.round.roundId}</div>
              <div><strong>Team ID:</strong> ${data.round.originTeamId}</div>
              <div><strong>Ranking:</strong> ${data.round.originRanking.join(', ')}</div>
              <div><strong>Message:</strong> ${data.message}</div>
            </div>
          `;
        } else {
          document.getElementById('originRankResult').innerText = `Error: ${data.error}`;
        }
      } catch (error) {
        document.getElementById('originRankResult').innerText = `Error: ${error.message}`;
      }
    }

    async function submitGuess() {
      const roundId = document.getElementById('guessRoundId').value;
      const teamId = document.getElementById('guessTeamId').value;
      const itemsText = document.getElementById('guessItems').value;
      
      if (!roundId || !teamId || !itemsText) {
        document.getElementById('guessResult').innerText = 'Please enter roundId, teamId, and items';
        return;
      }
      
      const guess = itemsText.split(/[\n,]/).map(item => item.trim()).filter(item => item.length > 0);
      if (guess.length === 0) {
        document.getElementById('guessResult').innerText = 'Please enter at least one item';
        return;
      }
      
      try {
        const res = await fetch('http://localhost:4000/api/submit-guess', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ roundId, teamId, guess })
        });
        const data = await res.json();
        
        if (res.ok) {
          document.getElementById('guessResult').innerHTML = `
            <div class="game-info">
              <div class="game-id">Guess Submitted!</div>
              <div><strong>Round ID:</strong> ${data.round.roundId}</div>
              <div><strong>Team ID:</strong> ${teamId}</div>
              <div><strong>Guessed Items:</strong> ${guess.join(', ')}</div>
              <div><strong>Message:</strong> ${data.message}</div>
            </div>
          `;
        } else {
          document.getElementById('guessResult').innerText = `Error: ${data.error}`;
        }
      } catch (error) {
        document.getElementById('guessResult').innerText = `Error: ${error.message}`;
      }
    }

    async function scoreGuesses() {
      const roundId = document.getElementById('scoreRoundId').value;
      if (!roundId) {
        document.getElementById('scoreResult').innerText = 'Please enter a roundId';
        return;
      }
      
      try {
        const res = await fetch(`http://localhost:4000/api/score-guesses/${roundId}`);
        const data = await res.json();
        
        if (res.ok) {
          let scoresHtml = '';
          if (data.scores.length > 0) {
            scoresHtml = data.scores.map(s => `<div><strong>${s.teamId}:</strong> ${s.score} correct items</div>`).join('');
          } else {
            scoresHtml = '<div>No guesses to score yet</div>';
          }
          
          document.getElementById('scoreResult').innerHTML = `
            <div class="game-info">
              <div class="game-id">Score Results</div>
              <div><strong>Round ID:</strong> ${data.roundId}</div>
              <div><strong>Total Guesses:</strong> ${data.totalGuesses}</div>
              <div><strong>Origin Ranking:</strong> ${data.originRanking ? data.originRanking.join(', ') : 'Not set'}</div>
              <div><strong>Scores:</strong></div>
              ${scoresHtml}
            </div>
          `;
        } else {
          document.getElementById('scoreResult').innerText = `Error: ${data.error}`;
        }
      } catch (error) {
        document.getElementById('scoreResult').innerText = `Error: ${error.message}`;
      }
    }

    async function getScoreboard() {
      const gameId = document.getElementById('scoreboardGameId').value;
      if (!gameId) {
        document.getElementById('scoreboardResult').innerText = 'Please enter a gameId';
        return;
      }
      
      try {
        const res = await fetch(`http://localhost:4000/api/scoreboard/${gameId}`);
        const data = await res.json();
        
        if (res.ok) {
          let scoreboardHtml = '';
          if (data.scoreboard.length > 0) {
            scoreboardHtml = data.scoreboard.map((team, index) => 
              `<div><strong>${index + 1}. ${team.teamName}:</strong> ${team.score} points</div>`
            ).join('');
          } else {
            scoreboardHtml = '<div>No scores to display yet</div>';
          }
          
          const totalPoints = data.scoreboard.reduce((sum, team) => sum + team.score, 0);
          
          document.getElementById('scoreboardResult').innerHTML = `
            <div class="game-info">
              <div class="game-id">Game Scoreboard</div>
              <div><strong>Game ID:</strong> ${data.gameId}</div>
              <div><strong>Total Rounds:</strong> ${data.totalRounds}</div>
              <div><strong>Total Points:</strong> ${totalPoints}</div>
              <div><strong>Team Rankings:</strong></div>
              ${scoreboardHtml}
            </div>
          `;
        } else {
          document.getElementById('scoreboardResult').innerText = `Error: ${data.error}`;
        }
      } catch (error) {
        document.getElementById('scoreboardResult').innerText = `Error: ${error.message}`;
      }
    }

    async function declareWinner() {
      const gameId = document.getElementById('winnerGameId').value;
      if (!gameId) {
        document.getElementById('winnerResult').innerText = 'Please enter a gameId';
        return;
      }
      
      try {
        const res = await fetch(`http://localhost:4000/api/declare-winner/${gameId}`);
        const data = await res.json();
        
        if (res.ok) {
          if (data.noScores) {
            document.getElementById('winnerResult').innerHTML = `
              <div class="game-info">
                <div class="game-id">No Winner Yet</div>
                <div><strong>Game ID:</strong> ${data.gameId}</div>
                <div><strong>Status:</strong> No scores recorded yet</div>
                <div><strong>Message:</strong> ${data.message}</div>
              </div>
            `;
          } else {
            let winnerDisplay = '';
            if (data.isTie) {
              winnerDisplay = `<div><strong>üèÜ It's a Tie!</strong></div>`;
            } else {
              winnerDisplay = `<div><strong>üèÜ Winner!</strong></div>`;
            }
            
            winnerDisplay += data.winners.map(winner => 
              `<div><strong>${winner.teamName}:</strong> ${data.maxScore} points</div>`
            ).join('');
            
            document.getElementById('winnerResult').innerHTML = `
              <div class="game-info">
                <div class="game-id">Winner(s) Declared!</div>
                <div><strong>Game ID:</strong> ${data.gameId}</div>
                ${winnerDisplay}
                <div><strong>Message:</strong> ${data.message}</div>
              </div>
            `;
          }
        } else {
          document.getElementById('winnerResult').innerText = `Error: ${data.error}`;
        }
      } catch (error) {
        document.getElementById('winnerResult').innerText = `Error: ${error.message}`;
      }
    }
  </script>
</body>
</html> 